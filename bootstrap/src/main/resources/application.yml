application:
  version: @project.version@

# /info actuator endpoint:
info:
  app:
    name: @project.parent.artifactId@
    version: @project.version@

spring:
  application.name: HESPERIDES
  boot.admin.client.enabled: false
  profiles.active: ${SPRING_PROFILES_ACTIVE:default}

server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /rest
  compression:
    enabled: true
    mime-types: application/json

hesperides:
  security:
    auth-whitelist: ${AUTH_WHITELIST:/versions|/manage/**|/swagger-resources/|/swagger-ui.html|/v2/api-docs|/webjars/**}
  cache:
    get-all-applications-detail:
      duration-in-hours: ${GET_ALL_APPLICATIONS_DETAIL_CACHE_DURATION_IN_HOURS:1}

ldap:  # bound to org.hesperides.core.infrastructure.security.LdapConfiguration
  url: ${LDAP_URL:}
  domain: ${LDAP_DOMAIN:}
  userSearchBase: ${LDAP_USER_SEARCH_BASE:}
  roleSearchBase: ${LDAP_ROLE_SEARCH_BASE:}
  prodGroupDN: ${LDAP_PROD_GROUP_DN:}
  techGroupDN: ${LDAP_TECH_GROUP_DN:}
  usernameAttribute: ${LDAP_USERNAME_ATTRIBUTE:sAMAccountName}
  connectTimeout: ${LDAP_CONNECT_TIMEOUT:5000}
  readTimeout: ${LDAP_READ_TIMEOUT:5000}
  max-number-of-tries: ${LDAP_RETRY_MAX_COUNT:3}
  delay-between-tries-in-seconds: ${LDAP_RETRY_DELAY_IN_SECS:1}

logging:
  file: /var/log/hesperides.log
  level:
    root: INFO
    org:
      axonframework.queryhandling.responsetypes.MultipleInstancesResponseType: WARN
      hesperides:
        commons:
          VersionIdLogger: ${VERSION_ID_LOG_LEVEL:INFO}
        core:
          application.files.FileValuationContext: ${FILE_VALUATION_LOG_LEVEL:INFO}
          domain:
            templatecontainers.entities.AbstractProperty: ${PROPERTY_AGGREGATION_LOG_LEVEL:INFO}
            modules.commands.ModuleAggregate: ${AGGREGATES_LOG_LEVEL:INFO}
            platforms.commands.PlatformAggregate: ${AGGREGATES_LOG_LEVEL:INFO}
          infrastructure.security.LdapAuthenticationProvider: ${LDAP_AUTH_PROVIDER_LOG_LEVEL:INFO}
      springframework:
        data.mongodb.core.MongoTemplate: ${MONGO_QUERIES_LOG_LEVEL:INFO}
        # On ne logue pas les nombreux "Ignoring PartialResultException"
        # dus aux champs referrals ignor√©s, cf. https://docs.spring.io/spring-ldap/docs/2.3.2.RELEASE/reference/#ldaptemplate-configuration
        security.ldap.SpringSecurityLdapTemplate: WARN

# Access it: http://localhost:8080/rest/manage
# Includes but does not limit to:
# - /manage/beans
# - /manage/caches
# - /manage/health
# - /manage/configprops
# - /manage/env
# - /manage/info
# - /manage/loggers
# - /manage/heapdump
# - /manage/threaddump
# - /manage/metrics
#   ex: /manage/metrics/cache.gets?tag=name:authorization-groups-tree&tag=result:hit
#   cf. https://github.com/micrometer-metrics/micrometer/blob/master/micrometer-core/src/main/java/io/micrometer/core/instrument/binder/cache/CacheMeterBinder.java#L49
#   cf. http://blog.davidvassallo.me/2018/03/13/drill-down-into-spring-boot-actuator-metrics/
# - /manage/scheduledtasks
# - /manage/httptrace
management:
  health:
    ldap:
      enabled: false
  endpoint:
    health:
      show-details: always
    prometheus:
      enabled: ${ENABLE_PROMETHEUS_METRICS:true}
  endpoints:
    web:
      base-path: /manage
      exposure:
        include: '*'

swagger.host: ${SWAGGER_HOST:}

sentry.ignored-exceptions: ${SENTRY_IGNORED_EXCEPTIONS:,}
